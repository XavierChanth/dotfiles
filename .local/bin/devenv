#!/bin/sh
name="$1"

if [ -z "$name" ]; then
  echo "name is empty"
  exit 1
fi

# Because trying to install things in linux arm64 is painful, so just use rosetta (nvim mason will thank you for it)
export DOCKER_DEFAULT_PLATFORM=linux/amd64

if docker ps --all | grep -q "$name"; then
  echo "starting $name"
  if ! docker ps | grep -q "$name"; then
    docker start "$name"
  fi
  docker exec -it "$name" /bin/zsh
else
  echo "creating new $name container"
  docker run -d --name "$name" --hostname "$name" --network "host" \
    --mount type=bind,source="$HOME"/.ssh,target=/home/chant/.ssh \
    --mount type=bind,source="$HOME"/.atsign,target=/home/chant/.atsign \
    --mount type=bind,source="$HOME"/src,target=/home/chant/src \
    devenv:latest
fi

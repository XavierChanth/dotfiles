#!/bin/sh
name="$1"
image="xavierchanth/devenv"

if [ -z "$name" ]; then
  echo "name is empty"
  exit 1
fi
export DOCKER_DEFAULT_PLATFORM=linux/amd64
if docker ps --all | grep "$image" | grep -q "$name"; then
  echo "starting $name"
  docker exec -it "$name" /bin/zsh
else
  echo "creating new $name container"
  docker run -d --name "$name" --hostname "$name" --network "host" \
    --mount type=bind,source="$HOME"/.ssh,target=/home/chant/.ssh \
    --mount type=bind,source="$HOME"/.atsign,target=/home/chant/.atsign \
    --mount type=bind,source="$HOME"/src,target=/home/chant/src \
    "$image":latest
fi
